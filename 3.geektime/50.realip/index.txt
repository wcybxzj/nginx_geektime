环境:
nginx :192.168.1.177
curl1 :192.168.1.177
curl2 :192.168.1.124
================================================================================================
./configure --prefix=/root/www/nginx --with-http_realip_module
make
make install
================================================================================================
实验1:
nginx.conf:
#set_real_ip_from 192.168.1.177;//不设置这个,意思是不允许请求修改$remote_addr

curl1 :192.168.1.177
curl -H 'X-Forwarded-For: 1.1.1.1,192.168.1.177' realip.ybx.tech:8080
Client real ip: 192.168.1.177

curl2 :192.168.1.124
curl -H 'X-Forwarded-For: 1.1.1.1,192.168.1.124' 192.168.1.177:8080
Client real ip: 192.168.1.124
================================================================================================
实验2:
nginx.conf:
set_real_ip_from 192.168.1.177;//意思是只允许这个ip的请求修改$remote_addr
nginx.conf: real_ip_recursive off;//意思是$remote_addr只获取X-Forwarded-For最后的ip

curl1 :192.168.1.177
curl -H 'X-Forwarded-For: 1.1.1.1,2.2.2.2' realip.ybx.tech:8080
Client real ip: 2.2.2.2

curl2 :192.168.1.124
curl -H 'X-Forwarded-For: 1.1.1.1,2.2.2.2' 192.168.1.177:8080
Client real ip: 192.168.1.124
================================================================================================
实验3:
set_real_ip_from 192.168.1.177;
nginx.conf: real_ip_recursive on;
